## SPDX-License-Identifier: Apache-2.0
#
# This script was generated by 'Solicitor', v$MODELROOT.getDataRow(0).solicitorVersion ($MODELROOT.getDataRow(0).solicitorGitHash) on $MODELROOT.getDataRow(0).executionTime
# see https://github.com/devonfw-forge/solicitor
#
# In order to use this function properly, a correct setup of scancode-toolkit is necessary. Download and install the newest version of scancode here: https://github.com/nexB/scancode-toolkit/releases
# It is important to note that scancode has to be put in the PATH variable and you are able to call the tool from everywhere in your system.
# After setting it up correctly, you just have to run the generated "scancode_projectname.sh" script to automatically create a list of copyrights and their holders called scancodeOutput.json
# Furthermore, two folders get created: Source (which contains all source files of downloaded artifacts) and scancodeOutput (which holds all individual scanned copyright information for each artifact)
# All artifacts that could not be downloaded are listed in need-to-retrieve-manually.txt. If further scancode-toolkit scans are necessary after the source download has been completed once, you can also just run the scancodeScan.sh script.

mkdir Source
cd Source
#[[SD=$(pwd)]]#
echo "These artifacts need to be downloaded manually:" > need-to-retrieve-manually.txt


#foreach ($artifact in $ARTIFACTS)
# Group: $artifact.groupId -- Artifact: $artifact.artifactId -- Version: $artifact.version -- License(s): $artifact.effectiveNormalizedLicense -- includeSource: $artifact.includeSource

	#if ( $artifact.artifactId.toString().contains("/") )
		cutArtifact='${artifact.artifactId}'

		if [ ! -d "#[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version" ]
		then
			mkdir #[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version
			cd #[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version
			#if ( $artifact.repoType == "maven" )
				curl -# https://repo1.maven.org/maven2/$artifact.groupIdT/#[[${cutArtifact#*/}]]#/$artifact.version/#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar -o $artifact.groupId--#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar
				unzip -q $artifact.groupId--#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar
					if [ $? -ne 0 ]
					then
						cd ..
						echo "maven $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar" >> need-to-retrieve-manually.txt   
						rm -r $artifact.artifactId-$artifact.version
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "npm" )
				curl -# https://registry.npmjs.org/$artifact.artifactId/-/#[[${cutArtifact#*/}]]#-${artifact.version}.tgz -o #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
				tar -xvzf #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "yarn" )
				curl -# https://registry.yarnpkg.com/$artifact.artifactId/-/#[[${cutArtifact#*/}]]#-${artifact.version}.tgz -o #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
				tar -xvzf #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version
					fi
				#[[cd $SD]]#
			#else
				cd ..
				echo "$artifact.groupId--$artifact.artifactId-${artifact.version} (unknown repoType)" >> need-to-retrieve-manually.txt
				rm -r $artifact.artifactId-$artifact.version
				#[[cd $SD]]#	
			#end
		fi	
	#else
		if [ ! -d "$artifact.artifactId-$artifact.version" ]
		then
			mkdir $artifact.artifactId-$artifact.version
			cd $artifact.artifactId-$artifact.version
			#if ( $artifact.repoType == "maven" )
				curl -# https://repo1.maven.org/maven2/$artifact.groupIdT/$artifact.artifactId/$artifact.version/$artifact.artifactId-$artifact.version-sources.jar -o $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar
				unzip -q $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar
					if [ $? -ne 0 ]
					then
						cd ..
						echo "maven $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar" >> need-to-retrieve-manually.txt   
						rm -r $artifact.artifactId-$artifact.version				
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "npm" )
				curl -# https://registry.npmjs.org/$artifact.artifactId/-/$artifact.artifactId-${artifact.version}.tgz -o $artifact.artifactId-${artifact.version}.tgz
				tar -xvzf $artifact.artifactId-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version					
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "yarn" )
				curl -# https://registry.yarnpkg.com/$artifact.artifactId/-/$artifact.artifactId-${artifact.version}.tgz -o $artifact.artifactId-${artifact.version}.tgz
				tar -xvzf $artifact.artifactId-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version					
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "pip" )
				art='${artifact.artifactId}'
				#[[firstChar=${art:0:1}]]#
				curl -# -L https://pypi.io/packages/source/#[[$firstChar]]#/$artifact.artifactId/$artifact.artifactId-${artifact.version}.tar.gz -o $artifact.artifactId-${artifact.version}.tar.gz
				tar -xvzf $artifact.artifactId-${artifact.version}.tar.gz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tar.gz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version					
					fi
				#[[cd $SD]]#
			#else
				cd ..
				echo "$artifact.groupId--$artifact.artifactId-${artifact.version} (unknown repoType)" >> need-to-retrieve-manually.txt
				rm -r $artifact.artifactId-$artifact.version
				#[[cd $SD]]#				
			#end
		fi
	#end
#end

cd ..
mv Source/need-to-retrieve-manually.txt need-to-retrieve-manually.txt
#[[sh scancodeScan.sh]]#