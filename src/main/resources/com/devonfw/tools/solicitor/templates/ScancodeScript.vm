## SPDX-License-Identifier: Apache-2.0
#
# This script was generated by 'Solicitor', v$MODELROOT.getDataRow(0).solicitorVersion ($MODELROOT.getDataRow(0).solicitorGitHash) on $MODELROOT.getDataRow(0).executionTime
# see https://github.com/devonfw-forge/solicitor
#
# How to use: 
# In order to use this function properly, a correct setup of scancode is necessary. Download and install this version of scancode here: https://github.com/nexB/scancode-toolkit/releases/tag/v21.3.31
# Make sure that you install it in a directory next to the projects that you want to scan with solicitor. After extracting it should look like this: ../Projects/scancode/scancode-toolkit-21.3.31 and the solicitor projects should stay next to it: ../Projects/project123/solicitor.jar
# After setting up everything correctly, one just have to run this script to automatically create a list of copyrights and their holders called scancodeOutput.json
# Furthermore two folders get created: Source (which contains all sourcefiles of downloaded artifacts) and scancodeOutput ( which holds all individual scanned copyright information for each artifact)
# All artifacts that could not be downloaded are listed in need-to-retrieve-manually.txt 
#

mkdir Source &> /dev/null
cd Source
#[[SD=$(pwd)]]#
echo "These artifacts need to be downloaded manually:" > need-to-retrieve-manually.txt


#foreach ($artifact in $ARTIFACTS)
# Group: $artifact.groupId -- Artifact: $artifact.artifactId -- Version: $artifact.version -- License(s): $artifact.effectiveNormalizedLicense -- includeSource: $artifact.includeSource

	#if ( $artifact.artifactId.toString().contains("/") )
		cutArtifact='${artifact.artifactId}'

		if [[ ! -d "#[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version" ]]
		then
			mkdir #[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version &> /dev/null
			cd #[[${cutArtifact%/*}+${cutArtifact#*/}]]#-$artifact.version
			#if ( $artifact.repoType == "maven" )
				curl -# https://repo1.maven.org/maven2/$artifact.groupIdT/#[[${cutArtifact#*/}]]#/$artifact.version/#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar -o $artifact.groupId--#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar
				unzip -q $artifact.groupId--#[[${cutArtifact#*/}]]#-$artifact.version-sources.jar
					if [ $? -ne 0 ]
					then
						cd ..
						echo "maven $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar" >> need-to-retrieve-manually.txt   
						rm -r $artifact.artifactId-$artifact.version
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "npm" )
				curl -# https://registry.npmjs.org/$artifact.artifactId/-/#[[${cutArtifact#*/}]]#-${artifact.version}.tgz -o #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
				tar -xvzf #[[${cutArtifact#*/}]]#-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version
					fi
				#[[cd $SD]]#
			#else
				cd ..
				echo "$artifact.groupId--$artifact.artifactId-${artifact.version} (unknown repoType)" >> need-to-retrieve-manually.txt
				rm -r $artifact.artifactId-$artifact.version
				#[[cd $SD]]#	
			#end
		fi	
	#else
		if [[ ! -d "$artifact.artifactId-$artifact.version" ]]
		then
			mkdir $artifact.artifactId-$artifact.version &> /dev/null
			cd $artifact.artifactId-$artifact.version
			#if ( $artifact.repoType == "maven" )
				curl -# https://repo1.maven.org/maven2/$artifact.groupIdT/$artifact.artifactId/$artifact.version/$artifact.artifactId-$artifact.version-sources.jar -o $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar
				unzip -q $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar
					if [ $? -ne 0 ]
					then
						cd ..
						echo "maven $artifact.groupId--$artifact.artifactId-$artifact.version-sources.jar" >> need-to-retrieve-manually.txt   
						rm -r $artifact.artifactId-$artifact.version				
					fi
				#[[cd $SD]]#
			#elseif ( $artifact.repoType == "npm" )
				curl -# https://registry.npmjs.org/$artifact.artifactId/-/$artifact.artifactId-${artifact.version}.tgz -o $artifact.artifactId-${artifact.version}.tgz
				tar -xvzf $artifact.artifactId-${artifact.version}.tgz
					if [ $? -ne 0 ]
					then
						cd ..
						echo "npm $artifact.artifactId-${artifact.version}.tgz" >> need-to-retrieve-manually.txt
						rm -r $artifact.artifactId-$artifact.version					
					fi
				#[[cd $SD]]#
			#else
				cd ..
				echo "$artifact.groupId--$artifact.artifactId-${artifact.version} (unknown repoType)" >> need-to-retrieve-manually.txt
				rm -r $artifact.artifactId-$artifact.version
				#[[cd $SD]]#				
			#end
		fi
	#end
#end

cd ..
mv Source/need-to-retrieve-manually.txt need-to-retrieve-manually.txt
start scancodeDownload.cmd